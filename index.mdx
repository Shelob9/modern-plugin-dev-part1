import { Head, Notes,future, highlight  } from 'mdx-deck'
import { theme } from './theme'
export const themes = [
  {...future,
  ...highlight,
  ...theme
  }
]

<Head>
  <title>
    The Modern WordPress Plugin Development Toolset (Part 1)
  </title>

</Head>

# The Modern WordPress Plugin Development Toolset (Part 1)

Josh Pollock | @josh412 | Josh412.eth

---

## What We Will Cover

To create your presentation

<Notes>
Create speaker notes with the Notes component
</Notes>

---

## The WordPress Stack

- Client (Browser)
  - JavaScript/ CSS/ HTML
- Server
  - PHP
- Database
  - MySQL

---


## React In WordPress


- Used in block editor
- Can be used for:
  - Admin pages
  - Front-end
  - Headless builds

---

## Developer Tooling

* Local Development Environment
* Dependency Management
* Automated Testing
* Compiling and Optimizing JS(X) and (SCSS)
* Code Quality
* CI/ CD

---

## Local Development

### Why

* Isolation
* Common setup for all developers on a project
* Automated configuration

---

## Local Development

### Solutions

* Docker
  - docker-compose
  - 10up Docker
  - Lando
* WordPress-specific GUI Apps
  - Desktop Server
  - Local by flywheel
* Virtual Machine
  - vvv
  - Homestead
---

## Local Development

### My Recommendation: Docker Compose

* Runs anywhere
  - Mac/ Windows/ Linux
  - Github Actions
  - vsCode dev containers
  - In the cloud
* Config as code
* Infinetly extendable

---

## Docker Compose

### Basic

```yml
version: "3.9"

services:

  wordpress:
    depends_on:
      - wpdb
    image: wordpress:latest
    volumes:
      - wordpress_data:/var/www/html
      - ./:/var/www/html/wp-content/plugins/everything-all-of-the-time
    ports:
      - "6100:80"
    restart: always
    environment:
      WORDPRESS_DB_HOST: wpdb:3306
      WORDPRESS_DB_USER: wordpress
      WORDPRESS_DB_PASSWORD: wordpress
      WORDPRESS_DB_NAME: wordpress

  wpdb:
    image: mysql:5.7
    volumes:
      - db_data:/var/lib/mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: wordpress
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wordpress
      MYSQL_PASSWORD: wordpress
```

---

## Docker Compose

### With WPCLI And Tests

```yml
version: "3.9"

services:

  wordpress:
    depends_on:
      - wpdb
    image: wordpress:latest
    volumes:
      - wordpress_data:/var/www/html
      - ./:/var/www/html/wp-content/plugins/everything-all-of-the-time
    ports:
      - "6100:80"
    restart: always
    environment:
      WORDPRESS_DB_HOST: wpdb:3306
      WORDPRESS_DB_USER: wordpress
      WORDPRESS_DB_PASSWORD: wordpress
      WORDPRESS_DB_NAME: wordpress

  wpdb:
    image: mysql:5.7
    volumes:
      - db_data:/var/lib/mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: wordpress
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wordpress
      MYSQL_PASSWORD: wordpress

  wpcli:
    image: wordpress:cli
    volumes:
      - wordpress_data:/var/www/html
      - ./:/var/www/html/wp-content/plugins/everything-all-of-the-time
      - ./db:/var/www/html/db
    environment:
      WORDPRESS_DB_HOST: db:3306
      WORDPRESS_DB_USER: wordpress
      WORDPRESS_DB_PASSWORD: wordpress
      WORDPRESS_DB_NAME: wordpress
      ABSPATH: /usr/src/wordpress/

  phpunit:
    command:
      - bash
    depends_on:
      - testwpdb
    environment:
      DATABASE_PASSWORD: examplepass
      DATABASE_HOST: testwpdb
    image: futureys/phpunit-wordpress-plugin
    stdin_open: true
    tty: true
    volumes:
      - ./:/plugin

  testwpdb:
      environment:
        MYSQL_ROOT_PASSWORD: examplepass
      image: mysql:5.7

volumes:
  db_data: {}
  wordpress_data: {}
```

## Dependency Management


- For PHP: Composer
- For JavaScript: yarn or yarn

---
## Composer

- Adding packages
- Running scripts
- PHP autoloader

---

## Composer

### Basic

```json
{
    "name": "imaginary-machines/everything-all-of-the-time",
    "description": "Example of Plugin Machine generated plugin with many features on.",
    "type": "wordpress-plugin",
    "require": {
        "php": "^7.2|^8.0"
    }
}
```
---

## Composer

### Autoloader

```json
{
    "autoload": {
        "psr-4": {
            "AllOfTheThings\\": "./php"
        }
    },
    "autoload-dev": {
        "psr-4": {
            "AllOfTheThings\\Tests\\": "./tests"
        }
    }
}
```

## npm (or Yarn)


- Add additional functionality
  - For example: component library, API client, utility functions, etc.
- Compile code so it can run in the browser and optimize it
  - Babel, webpack, etc.
- Running scripts
- Configuring Packages

---

## package.json

### Basic
```json
{
    "name": "@imaginary-machines/everything-all-of-the-time",
    "private": true,
    "version": "0.1.0",
    "license": "GPL-2.0-or-later",
    "main": "build/index.js",
    "scripts": {
        "build": "wp-scripts build",
        "lint:css": "wp-scripts lint-style",
        "lint:js": "wp-scripts lint-js",
        "start": "wp-scripts start"
    },
    "devDependencies": {
        "@wordpress/scripts": "^16"
    }
}
```

---


## Automated Tests

- Guide development.
- Prevent regression errors.
- Makes clear how the code is supposed to work.
- Debugging errors.
- Profiling performance.
- Surfacing a11y issues

### What


---

## Automated Tests

### Why Use

- Guide development.
- Prevent regression errors.
- Makes clear how the code is supposed to work.
- Debugging errors.
- Profiling performance.
- Surfacing a11y issues

---

## phpunit

- PHP test runner and assertions.
- Can be used with or without WordPress test suite.

---

## Composer For phpunit


```json
{
    "require-dev": {
        "phpunit/phpunit": "^7.0",
        "yoast/phpunit-polyfills": "^0.1.0",
        "mockery/mockery": "1.2",
        "brain/monkey": "2.*",
        "squizlabs/php_codesniffer": "^3.6"
    },
    "scripts": {
        "test:unit": "phpunit --config=phpunit-unit.xml",
        "test:wordpress": "phpunit --config=phpunit-integration.xml"
    }
}
```
---

## WordPress Scripts

- Compiles
  - WordPress-safe.
  - Works with `p_register_script/style()`
- Lints
- Runs tests
  - Uses and configures Jest.

---
## Compiling JavaScript

### Why

- Allows for alternative syntaxes
  - JSX
- Optimize JavaScript
- Optimize CSS

---

## JSX

- React's template syntax
- Not required for React or blocks
  - Worth using for sure.
- HTML and JavaScript together

---

## JSX

```jsx
//React component with JSX
function Alert({message}){
    return (
        <div>
            <p className="alert">
            {message}</p>
        </div>
    );
}

<Alert message="Hi Roy" />
```

Renders as:

```html
<div>
    <p class="alert">
        Hi Roy
    </p>
</div>
```

---
## JSX

```jsx
//React component with JSX
function Alert({message}){
    return (
        <div>
            <p className="alert">
            {message}</p>
        </div>
    );
}

```

Is the same as:

```javascript
//React component without JSX
function Alert({message}){
    return React.createElement( 'div', {},[
        React.createElement( 'p', {
            className: 'alert'
        }, [ message ])
    ]);
}
```
---


## Testing JavaScript

- [Use Jest, via WordPress Scripts](https://fbjest.io)
- Generally need a React testing library in adittion to Jest.
  - I recommend [@testing-library/react]()
- [Slides For My JavaScript Testing Talk](https://shelob9.github.io/testing-javascript-in-and-around-wordpress/)


## Testing JavaScript

### Whypackage.json With Tests

```json
{
    "name": "@imaginary-machines/everything-all-of-the-time",
    "private": true,
    "version": "0.1.0",
    "license": "GPL-2.0-or-later",
    "main": "build/index.js",
    "scripts": {
        "test": "yarn test:unit",
        "test:unit": "wp-scripts test-unit-js",
        "build": "wp-scripts build",
        "test:ci": "wp-scripts test-unit-js --ci",
        "format:js": "wp-scripts format-js",
        "lint:css": "wp-scripts lint-style",
        "lint:js": "wp-scripts lint-js",
        "start": "wp-scripts start"
    },
    "devDependencies": {
        "@babel/core": "^7",
        "@testing-library/react": "^12",
        "@wordpress/scripts": "^16",
    },
    "dependencies": {
        "@wordpress/block-editor": "^6",
        "@wordpress/blocks": "^9",
        "@wordpress/components": "^14",
        "@wordpress/element": "^3",
        "@wordpress/i18n": "^4"
    }
}
```

---
## CI/ CD

---
